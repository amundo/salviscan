<!doctype html>
<html>
<head>
<title>salviscan</title>
<meta charset=utf-8>
<script src=js/jquery.js></script>
<script src=js/underscore.js></script>
<script src=js/backbone.js></script>
<script src=js/d3.v3.js></script>
<script src=js/prefixfree.js></script>

<link rel="icon" type="image/png" href="img/favicon.png">

<link rel=stylesheet href=css/style.css />
<link rel=stylesheet href=css/mobile.css />
<script>

function show(obj){ console.log(JSON.stringify(obj, null, 2))}

function secondsToTime(secs)
{
    var hours = Math.floor(secs / (60 * 60));

    var divisor_for_minutes = secs % (60 * 60);
    var minutes = Math.floor(divisor_for_minutes / 60);

    var divisor_for_seconds = divisor_for_minutes % 60;
    var seconds = Math.ceil(divisor_for_seconds);

    if (hours   < 10) {hours   = "0"+hours;}
    if (minutes < 10) {minutes = "0"+minutes;}
    if (seconds < 10) {seconds = "0"+seconds;}

    var stamp = {
        "h": hours,
        "m": minutes,
        "s": seconds
    };

    return [stamp.h, stamp.m, stamp.s].join(':');
}

$(function(){


 var $ta = $('textarea');
      ta = $ta.get(0),
     $ul = $('ul'),
      ul = $ul.get(0),
     $video = $('video'),
      video = $video.get(0),
      annotations = [];

 $(document).on('keyup', function(ev){

   if (ev.which == 27){
     if (video.paused) { video.play() } 
     else { video.pause() }
   }

 })
 
 $ta.on('keyup', function(ev){

  if( ev.which == 13){
  
    var annotation = {};

    annotation.end = video.currentTime;
    annotation.annotation = ta.value.trim();

    if(annotations.length == 0){
      annotation.start = 0;
      annotations.push(annotation);
    } else { 
      annotation.start = _.last(annotations).end;
      annotations.push(annotation);
    }
    
    show(annotations);

    $ul.append('<li> [' + secondsToTime(annotation.start) + 'â€”' + secondsToTime(annotation.end) + '] ' + annotation.annotation + '</li>');
    ta.value = '';

  };

 })


})
</script>

</head>
<body>
<nav>
<button id=exportButton>export</button>
</nav>

<video class=media controls>
 <source src="media/genius.mov" >
</video>

<div id=work>
<textarea id=annotation autofocus>

</textarea>
<ul id=annotations></ul>
</div><!-- work -->


<div id=export>
 <button id=closeExportButton>close</button>
 <textarea></textarea>
 <h2>cut &amp; paste this into a text file</h2>
</div><!-- export -->

</body>
</html>
